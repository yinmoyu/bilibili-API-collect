import{_ as i,c as o,a as d,b as n,d as s,e,w as l,r,o as p}from"./app-Dgsdh8A6.js";const m={};function c(u,t){const a=r("RouteLink");return p(),o("div",null,[t[18]||(t[18]=d('<h1 id="protobufå¼¹å¹•" tabindex="-1"><a class="header-anchor" href="#protobufå¼¹å¹•"><span>protobufå¼¹å¹•</span></a></h1><p>2020å¹´5æœˆ23æ—¥ï¼Œå“”å“©å“”å“©ç½‘é¡µç«¯åŠç§»åŠ¨ç«¯å¯ç”¨äº†æ–°çš„é»˜è®¤å¼¹å¹• APIï¼Œç½‘é¡µç«¯å¼¹å¹•æ˜¾ç¤ºçš„ä¸Šé™å˜ä¸ºåŸå¼¹å¹•æ± ä¸Šé™çš„ä¸¤å€ã€‚</p><p>æ–°çš„ API æ˜¯ä»¥ 6min ä¸ºä¸€ä¸ªå•ä½åŠ è½½ï¼Œå³æ¯æ¬¡åŠ è½½ 6min å†…çš„å¼¹å¹•</p><h2 id="è·å–å®æ—¶å¼¹å¹•" tabindex="-1"><a class="header-anchor" href="#è·å–å®æ—¶å¼¹å¹•"><span>è·å–å®æ—¶å¼¹å¹•</span></a></h2><blockquote><p>https://api.bilibili.com/x/v2/dm/web/seg.so ï¼ˆwebç«¯ï¼‰</p><p>https://api.bilibili.com/x/v2/dm/wbi/web/seg.so ï¼ˆweb ç«¯æ–°æ¥å£ï¼Œéœ€è¦ wbi è®¤è¯ï¼‰</p><p>https://api.bilibili.com/x/v2/dm/list/seg.so ï¼ˆAPPç«¯ï¼‰</p><p>https://i0.hdslb.com/bfs/dm/{data}.bin ï¼ˆBAS/ä»£ç å¼¹å¹•ä¸“åŒ…ï¼‰</p></blockquote><p><em>è¯·æ±‚æ–¹å¼ï¼šGET</em><em>è®¤è¯æ–¹å¼ï¼šåŠåŒ¿åï¼ˆéƒ¨åˆ†è§†é¢‘åœ¨æ—  Cookie: SESSDATA æ—¶åªè¿”å›éƒ¨åˆ†å¼¹å¹•ï¼‰</em></p><p>æ­¤æ¥å£ä¸æ¼«ç”»å¼¹å¹•ç›¸åŒ</p>',7)),n("p",null,[t[1]||(t[1]=s("åªèƒ½è¿”å›æ™®é€šå¼¹å¹•ï¼ˆ")),t[2]||(t[2]=n("code",null,"pool=1",-1)),t[3]||(t[3]=s()),t[4]||(t[4]=n("code",null,"mode=1-7",-1)),t[5]||(t[5]=s("ï¼‰å’Œä»£ç å¼¹å¹•ï¼ˆ")),t[6]||(t[6]=n("code",null,"pool=2",-1)),t[7]||(t[7]=s()),t[8]||(t[8]=n("code",null,"mode=8",-1)),t[9]||(t[9]=s("ï¼‰ï¼ŒBASå¼¹å¹•ï¼ˆ")),t[10]||(t[10]=n("code",null,"pool=2",-1)),t[11]||(t[11]=s()),t[12]||(t[12]=n("code",null,"mode=9",-1)),t[13]||(t[13]=s("ï¼‰è¯·ä»")),e(a,{to:"/docs/danmaku/danmaku_view_proto.html"},{default:l(()=>t[0]||(t[0]=[s("å¼¹å¹•å…ƒæ•°æ®")])),_:1,__:[0]}),t[14]||(t[14]=s("ä¸­è·å–"))]),n("p",null,[t[16]||(t[16]=s("äº’åŠ¨å¼¹å¹•ï¼ˆUP ä¸»å¤´åƒå¼¹å¹•ã€å…³è”è§†é¢‘ã€å†…åµŒå…³æ³¨æŒ‰é’®ï¼‰ä¹Ÿä¸å­˜åœ¨è¿™ä¸ªæ¥å£ï¼Œè¯·ä»")),e(a,{to:"/docs/danmaku/danmaku_view_proto.html"},{default:l(()=>t[15]||(t[15]=[s("å¼¹å¹•å…ƒæ•°æ®")])),_:1,__:[15]}),t[17]||(t[17]=s("ä¸­è·å–"))]),t[19]||(t[19]=d(`<p><strong>æ³¨ï¼šä»…è·å– 6min çš„æ•´æ•°å€æ—¶é—´å†…çš„å¼¹å¹•ï¼Œ6min å†…æœ€å¤šå¼¹å¹•æ•°ä¸º 6000 æ¡ï¼ˆå¦‚ç¬¬ä¸€åŒ…ä¸­å¼¹å¹•<code>progress</code>å€¼åŸŸä¸º0-360000ï¼‰</strong></p><p><strong>urlå‚æ•°ï¼š</strong></p><table><thead><tr><th>å‚æ•°å</th><th>ç±»å‹</th><th>å†…å®¹</th><th>å¿…è¦æ€§</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>type</td><td>num</td><td>å¼¹å¹•ç±»</td><td>å¿…è¦</td><td>1ï¼šè§†é¢‘å¼¹å¹•<br>2ï¼šæ¼«ç”»å¼¹å¹•</td></tr><tr><td>oid</td><td>num</td><td>è§†é¢‘ cid</td><td>å¿…è¦</td><td></td></tr><tr><td>pid</td><td>num</td><td>ç¨¿ä»¶ avid</td><td>éå¿…è¦</td><td></td></tr><tr><td>segment_index</td><td>num</td><td>åˆ†åŒ…</td><td>å¿…è¦</td><td>6min ä¸€åŒ…</td></tr><tr><td>pull_mode</td><td>num</td><td>ï¼ˆï¼Ÿï¼‰</td><td>éå¿…è¦</td><td></td></tr><tr><td>ps</td><td>num</td><td>ï¼ˆï¼Ÿï¼‰</td><td>éå¿…è¦</td><td></td></tr><tr><td>pe</td><td>num</td><td>ï¼ˆï¼Ÿï¼‰</td><td>éå¿…è¦</td><td></td></tr></tbody></table><p><strong>protoå›å¤ï¼š</strong></p><p>protoå®šä¹‰è§ï¼š<a href="../../grpc_api/bilibili/community/service/dm/v1/dm.proto">bilibili.community.service.dm.v1.DmSegMobileReply</a></p><ul><li><p><a href="https://protogen.marcgravell.com/" target="_blank" rel="noopener noreferrer">protogen.marcgravell</a>: åœ¨çº¿ç¼–è¯‘ protogen å·¥å…·, æ— éœ€å†å®‰è£…æœ¬åœ°ç¼–è¯‘å™¨(ç”Ÿæˆæ–‡ä»¶éœ€åŠ åç¼€<code>_pb2.py</code>æ‰å¯ä½¿ç”¨)</p></li><li><p><a href="https://pypi.org/project/protobuf/" target="_blank" rel="noopener noreferrer">protobuf pip</a>: å¯ä¸€é”®å®‰è£…çš„ Python çš„ protogen è§£æåº“</p></li></ul><p>æ¶ˆæ¯<code>DmSegMobileReply</code>ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å«ä¹‰</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>elems</td><td>repeated DanmakuElem</td><td>å¼¹å¹•æ¡ç›®</td><td></td></tr></tbody></table><p>æ¶ˆæ¯<code>DanmakuElem</code>ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å«ä¹‰</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>id</td><td>int64</td><td>å¼¹å¹• dmid</td><td>å”¯ä¸€ å¯ç”¨äºæ“ä½œå‚æ•°</td></tr><tr><td>progress</td><td>int32</td><td>è§†é¢‘å†…å¼¹å¹•å‡ºç°æ—¶é—´</td><td>æ¯«ç§’</td></tr><tr><td>mode</td><td>int32</td><td>å¼¹å¹•ç±»å‹</td><td>1 2 3ï¼šæ™®é€šå¼¹å¹•<br>4ï¼šåº•éƒ¨å¼¹å¹•<br>5ï¼šé¡¶éƒ¨å¼¹å¹•<br>6ï¼šé€†å‘å¼¹å¹•<br>7ï¼šé«˜çº§å¼¹å¹•<br>8ï¼šä»£ç å¼¹å¹•<br>9ï¼šBAS å¼¹å¹•ï¼ˆä»…é™äºç‰¹æ®Šå¼¹å¹•ä¸“åŒ…ï¼‰</td></tr><tr><td>fontsize</td><td>int32</td><td>å¼¹å¹•å­—å·</td><td>18ï¼šå°<br>25ï¼šæ ‡å‡†<br>36ï¼šå¤§</td></tr><tr><td>color</td><td>uint32</td><td>å¼¹å¹•é¢œè‰²</td><td>åè¿›åˆ¶ RGB888 å€¼</td></tr><tr><td>midHash</td><td>string</td><td>å‘é€è€… mid çš„ HASH</td><td>ç”¨äºå±è”½ç”¨æˆ·å’ŒæŸ¥çœ‹ç”¨æˆ·å‘é€çš„æ‰€æœ‰å¼¹å¹•ï¼Œä¹Ÿå¯åæŸ¥ç”¨æˆ·id</td></tr><tr><td>content</td><td>string</td><td>å¼¹å¹•å†…å®¹</td><td>utf-8ç¼–ç </td></tr><tr><td>ctime</td><td>int64</td><td>å¼¹å¹•å‘é€æ—¶é—´</td><td>æ—¶é—´æˆ³</td></tr><tr><td>weight</td><td>int32</td><td>æƒé‡</td><td>ç”¨äºæ™ºèƒ½å±è”½ï¼Œæ ¹æ®å¼¹å¹•è¯­ä¹‰åŠé•¿åº¦é€šè¿‡AIè¯†åˆ«å¾—å‡º<br>èŒƒå›´ï¼š[0-10]<br>å€¼è¶Šå¤§æƒé‡è¶Šé«˜</td></tr><tr><td>action</td><td>string</td><td>åŠ¨ä½œï¼Ÿ</td><td></td></tr><tr><td>pool</td><td>int32</td><td>å¼¹å¹•æ± </td><td>0ï¼šæ™®é€šæ± <br>1ï¼šå­—å¹•æ± <br>2ï¼šç‰¹æ®Šæ± ï¼ˆä»£ç /BASå¼¹å¹•ï¼‰</td></tr><tr><td>idStr</td><td>string</td><td>å¼¹å¹• dmid</td><td>å­—ä¸²å½¢å¼<br>å”¯ä¸€ å¯ç”¨äºæ“ä½œå‚æ•°</td></tr><tr><td>attr</td><td>int32</td><td>å¼¹å¹•å±æ€§ä½</td><td>bit0ï¼šä¿æŠ¤<br>bit1ï¼šç›´æ’­<br>bit2ï¼šé«˜èµ</td></tr><tr><td>animation</td><td>string</td><td>åŠ¨ç”»ï¼Ÿ</td><td></td></tr></tbody></table><p><strong>ç¤ºä¾‹ï¼š</strong></p><p>è·å–è§†é¢‘<code>av810872(cid=1176840)</code>ï¼ˆç‚®å§ï¼‰çš„å®æ—¶å¼¹å¹•åˆ†åŒ… 1</p><p><strong>æ³¨ï¼šä»¥ä¸‹<a href="../grpc_api/bilibili/community/service/dm/v1/dm.proto">protoå®šä¹‰</a>éœ€è¦ç¼–è¯‘ï¼Œ<code>bilibili.community.service.dm.v1.dm_pb2</code>å¹¶éé€šè¿‡ pypi å®‰è£…</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="background-color:#1E1E1E;color:#D4D4D4;"><pre class="shiki dark-plus vp-code"><code class="language-python"><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> requests</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> google.protobuf.text_format </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> text_format</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> bilibili.community.service.dm.v1.dm_pb2 </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> Danmaku</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">url = </span><span style="color:#CE9178;">&#39;https://api.bilibili.com/x/v2/dm/web/seg.so&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">params = {</span></span>
<span class="line"><span style="color:#CE9178;">    &#39;type&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,         </span><span style="color:#6A9955;"># å¼¹å¹•ç±»å‹</span></span>
<span class="line"><span style="color:#CE9178;">    &#39;oid&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1176840</span><span style="color:#D4D4D4;">,    </span><span style="color:#6A9955;"># cid</span></span>
<span class="line"><span style="color:#CE9178;">    &#39;pid&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">810872</span><span style="color:#D4D4D4;">,     </span><span style="color:#6A9955;"># avid</span></span>
<span class="line"><span style="color:#CE9178;">    &#39;segment_index&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span><span style="color:#6A9955;"> # å¼¹å¹•åˆ†æ®µ</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#D4D4D4;">resp = requests.get(url, params)</span></span>
<span class="line"><span style="color:#D4D4D4;">data = resp.content</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">danmaku_seg = Danmaku.DmSegMobileReply()</span></span>
<span class="line"><span style="color:#D4D4D4;">danmaku_seg.ParseFromString(data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(text_format.MessageToString(danmaku_seg.elems[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">], </span><span style="color:#9CDCFE;">as_utf8</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="background-color:#1E1E1E;color:#D4D4D4;"><pre class="shiki dark-plus vp-code"><code class="language-"><span class="line"><span>id: 711923911</span></span>
<span class="line"><span>progress: 47880</span></span>
<span class="line"><span>mode: 1</span></span>
<span class="line"><span>fontsize: 18</span></span>
<span class="line"><span>color: 10092288</span></span>
<span class="line"><span>midHash: &quot;59417e95&quot;</span></span>
<span class="line"><span>content: &quot;ä¸–ç•Œç¬¬ä¸€ç”µå‡»å…¬ä¸»æ®¿ä¸‹,é‡åˆ°ä½ æ˜¯æˆ‘ä¸€ç”Ÿæœ€ç¾å¥½çš„é£æ™¯!å¾ç‚®èµ›é«˜,æ°¸ç”Ÿä¸ç¦»!å”¯æˆ‘è¶…ç”µç£ç‚®æ°¸ä¸–é•¿å­˜! &quot;</span></span>
<span class="line"><span>ctime: 1418799826</span></span>
<span class="line"><span>weight: 6</span></span>
<span class="line"><span>idStr: &quot;711923911&quot;</span></span>
<span class="line"><span>attr: 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16))])}const v=i(m,[["render",c]]),D=JSON.parse('{"path":"/docs/danmaku/danmaku_proto.html","title":"protobufå¼¹å¹•","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1696153717000,"contributors":[{"name":"SocialSisterYi","username":"SocialSisterYi","email":"1440239038@qq.com","commits":3,"url":"https://github.com/SocialSisterYi"},{"name":"gwy15","username":"gwy15","email":"gwy15thu@gmail.com","commits":1,"url":"https://github.com/gwy15"},{"name":"LaMerChiang","username":"LaMerChiang","email":"catlair@qq.com","commits":1,"url":"https://github.com/LaMerChiang"}],"changelog":[{"hash":"4dac6cc2d0013c06c5cdf397d9dfc72a1c3531c4","time":1696153717000,"email":"catlair@qq.com","author":"LaMerChiang","message":"æ ‡æ³¨éƒ¨åˆ† wbi é“¾æ¥ (#827)"},{"hash":"c2d9291c0026350e07c01e59fc8a3ee0e0cd42f1","time":1693028780000,"email":"gwy15thu@gmail.com","author":"gwy15","message":"Update danmaku_proto.mdï¼Œå¢åŠ è®¤è¯è¯´æ˜ (#792)"},{"hash":"87d56b66e7ce375029bccf9efda5314964b0528d","time":1684287732000,"email":"1440239038@qq.com","author":"SocialSisterYi","message":"update ã€danmaku thumbup listã€‘ APIDoc"},{"hash":"f6760f4be38d5b592d396b211e48c666286524de","time":1677124138000,"email":"1440239038@qq.com","author":"SocialSisterYi","message":"ğŸ”¨remove header index"},{"hash":"7d89ece2ac46425810647c4ac92acf5f3721cb68","time":1676998806000,"email":"1440239038@qq.com","author":"SocialSisterYi","message":"ğŸš€è°ƒæ•´é¡¹ç›®ç»“æ„"}]},"filePathRelative":"docs/danmaku/danmaku_proto.md"}');export{v as comp,D as data};
